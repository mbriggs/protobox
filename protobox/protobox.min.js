var Protobox=null;(function(){var g={overlay:true,opacity:0.3,loadingImage:"images/protobox/loading.gif",closeImage:"images/protobox/closelabel.gif",animationSpeed:0.3,imageTypes:["png","jpg","jpeg","gif"],protoboxHtml:'    <div id="protobox" style="display:none;">       <div class="popup">         <table>           <tbody id="protobox-tbody">             <tr>               <td class="tl"/><td class="b"/><td class="tr"/>             </tr>             <tr>               <td class="b"/>               <td id="protobox-body">                 <a href="#" class="close">                   <img src="images/protobox/closelabel.gif" title="close" id="protobox-close-image" />                 </a>                 <div id="protobox-content">                 </div>               </td>               <td class="b"/>             </tr>             <tr>               <td class="bl"/><td class="b"/><td class="br"/>             </tr>           </tbody>         </table>       </div>     </div>'};var h=function(n){f(that.settings);c(that.settings,this.href,klass);n.stop()};Protobox=Class.create({settings:{},initialize:function(){klass=null;switch(arguments.length){case 3:this.settings=arguments[1];klass=arguments[2];case 2:arg1=arguments[0];arg2=arguments[1];if(typeof(arg1)==="string"&&typeof(arg2)==="object"&&arg2!=null){this.settings=arg2}if(typeof(arg1)==="object"&&arg1!=null&&typeof(arg2)==="string"){klass=arg2;this.settings=arg1;break}if(typeof(arg1)==="string"&&typeof(arg2)==="string"){klass=arg2}case 1:this.settings=m(this.settings);this.watch(arguments[0],klass);break}},watch:function(o,n){that=this;this.stopWatching(o);$$(o).each(function(p){p.observe("click",h)})},stopWatching:function(n){$$(n).invoke("stopObserving","click",h)}});Protobox.box=function(o,n){settings={};f(settings);if(o.ajax){l(settings,o.ajax,n)}else{if(o.image){d(settings,o.image,n)}else{if(o.div){c(settings,o.div,n)}else{if(Object.isFunction(o)){o.call($)}else{Protobox.reveal(settings,o,n)}}}}};Protobox.reveal=function(p,q,n){$(document).fire("protobox.beforeReveal");var o=j(q)+40;if(o>205){var r=(i.width()/2)-(o/2);$("protobox").setStyle({width:o+"px",left:r+"px"})}if(n){$("protobox-content").addClassName(n)}$("protobox-content").update(q);if($("protobox-loading")){$("protobox-loading").remove()}$("protobox-body").childElements().invoke("appear",{duration:p.animationSpeed});$(document).fire("protobox:reveal");$(document).fire("protobox:afterReveal")};Protobox.close=function(n){if(!n){n={}}if(!n.inited){n=m(n)}$(document).fire("protobox:close");$(document).stopObserving("keypress");$("protobox-overlay").stopObserving("click");$("protobox").fade({duration:n.animationSpeed,from:n.opacity,afterFinish:function(){$("protobox-content").writeAttribute("class","content")}});a(n);if($("protobox-loading")){$("protobox-loading").remove()}$(document).fire("protobox:afterClose");return false};function j(n){var p="float: left !important; visibility: hidden !important; border: 0px !important; margin: 0px !important; padding: 0px !important;";var r="<div id='proto-temp-content' style='"+p+"'>"+n+"</div>";$(document.body).insert(r);var q=$("proto-temp-content");var o=q.offsetWidth;q.remove();return o}function k(){var o,n;if(window.pageYOffset){n=window.pageYOffset;o=window.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){n=document.documentElement.scrollTop;o=document.documentElement.scrollLeft}else{if(document.body){n=document.body.scrollTop;o=document.body.scrollLeft}}}return[o,n]}var i={width:function(){var n=0;if(typeof(window.innerWidth)=="number"){n=window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){n=document.documentElement.clientWidth}else{if(document.body&&document.body.clientWidth){n=document.body.clientWidth}}}return n},height:function(){var n=0;if(typeof(window.innerHeight)=="number"){n=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){n=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){n=document.body.clientHeight}}}return n}};function c(q,o,n){if(o.match(/#/)){var p=window.location.href.split("#")[0];var r=o.replace(p,"");if(r=="#"){return}if(r.substr(0,1)=="#"){r=r.substr(1)}if($(r)){Protobox.reveal(q,$(r).innerHTML,n)}}else{if(o.match(q.imageTypesRegexp)){d(q,o,n)}else{l(q,o,n)}}}function d(p,o,n){var q=new Image();q.onload=function(){Protobox.reveal(p,'<div class="image"><img src="'+q.src+'" /></div>',n)};q.src=o}function l(p,o,n){new Ajax.Request(o,{method:"GET",onSuccess:function(q){Protobox.reveal(p,q.responseText,n)}})}function b(n){return n.overlay==false}function e(n){if(b(n)){return}if($("protobox-overlay")==null){$(document.body).insert('<div id="protobox-overlay"></div>')}$("protobox-overlay").hide().addClassName("protobox-overlayBG").observe("click",function(){$(document).fire("protobox:close")}).show();new Effect.Opacity("protobox-overlay",{duration:n.animationSpeed,from:0,to:n.opacity});$("protobox-overlay").observe("click",function(){Protobox.close()});return false}function a(n){if(b(n)){return}$("protobox-overlay").fade({duration:n.animationSpeed,from:n.opacity,afterFinish:function(){$("protobox-overlay").remove()}});return false}function m(p){if(p.inited){return p}else{p.inited=true}Object.extend(p,g);$(document).fire("protobox:init");var n=p.imageTypes.join("|");p.imageTypesRegexp=new RegExp(".("+n+")$","i");if($("protobox")==null){$(document.body).insert(p.protoboxHtml)}var o=[new Image(),new Image()];o[0].src=p.closeImage;o[1].src=p.loadingImage;$$("#protobox .b:first, #protobox .bl").each(function(q){o.push(new Image());o.last.src=q.getStyle("background-image").replace(/url\((.+)\)/,"$1")});$("protobox-close-image").writeAttribute("src",p.closeImage);return p}function f(n){n=m(n);if($("protobox-loading")){return true}e(n);$("protobox-body").childElements().invoke("hide");$("protobox-body").insert('<div id="protobox-loading"><img src="'+n.loadingImage+'"/></div>');$("protobox").setStyle({top:(k()[1]+(i.height()/10))+"px",left:(i.width()/2-205)+"px"}).show();$(document).observe("keypress",function(o){if(o.keyCode==Event.KEY_ESC){Protobox.close()}return true});$(document).fire("protobox:loading")}})();