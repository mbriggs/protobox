var Protobox=null;(function(){var g={overlay:true,opacity:0.3,loadingImage:"images/protobox/loading.gif",closeImage:"images/protobox/closelabel.gif",animationSpeed:0.3,imageTypes:["png","jpg","jpeg","gif"],protoboxHtml:'    <div id="protobox" style="display:none;">       <div class="popup">         <table>           <tbody id="protobox-tbody">             <tr>               <td class="tl"/><td class="b"/><td class="tr"/>             </tr>             <tr>               <td class="b"/>               <td id="protobox-body">                 <a href="#" class="close">                   <img src="images/protobox/closelabel.gif" title="close" id="protobox-close-image" />                 </a>                 <div id="protobox-content">                 </div>               </td>               <td class="b"/>             </tr>             <tr>               <td class="bl"/><td class="b"/><td class="br"/>             </tr>           </tbody>         </table>       </div>     </div>'};Protobox=Class.create({settings:{},initialize:function(){klass=null;switch(arguments.length){case 3:this.settings=arguments[1];klass=arguments[2];case 2:arg1=arguments[0];arg2=arguments[1];if(typeof(arg1)==="string"&&typeof(arg2)==="object"&&arg2!=null){this.settings=arg2}if(typeof(arg1)==="object"&&arg1!=null&&typeof(arg2)==="string"){klass=arg2;this.settings=arg1;break}if(typeof(arg1)==="string"&&typeof(arg2)==="string"){klass=arg2}case 1:this.watch(arguments[0],klass);break}this.settings=k(this.settings)},watch:function(m,l){$$(m).each(function(n){n.observe("click",function(){b(this.settings,this.href,l)})})},stopWatching:function(l){$$(l).invoke("stopObserving","click")}});Protobox.box=function(m,l){settings={};f(settings);if(m.ajax){j(settings,m.ajax,l)}else{if(m.image){d(settings,m.image,l)}else{if(m.div){b(settings,m.div,l)}else{if(Object.isFunction(m)){m.call($)}else{Protobox.reveal(settings,m,l)}}}}};Protobox.reveal=function(m,n,l){$(document).fire("protobox.beforeReveal");if(l){$("protobox-content").addClassName(l)}$("protobox-content").update(n);if($("protobox-loading")){$("protobox-loading").remove()}$("protobox-body").childElements().invoke("appear",{duration:m.animationSpeed});$(document).fire("protobox:reveal");$(document).fire("protobox:afterReveal")};Protobox.close=function(l){if(!l){l={}}if(!l.inited){l=k(l)}$(document).fire("protobox:close");$(document).stopObserving("keypress");$("protobox-overlay").stopObserving("click");$("protobox").fade({duration:l.animationSpeed,from:l.opacity,afterFinish:function(){$("protobox-content").writeAttribute("class","content")}});a(l);if($("protobox-loading")){$("protobox-loading").remove()}$(document).fire("protobox:afterClose");return false};function i(){var m,l;if(window.pageYOffset){l=window.pageYOffset;m=window.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){l=document.documentElement.scrollTop;m=document.documentElement.scrollLeft}else{if(document.body){l=document.body.scrollTop;m=document.body.scrollLeft}}}return[m,l]}var h={width:function(){var l=0;if(typeof(window.innerWidth)=="number"){l=window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){l=document.documentElement.clientWidth}else{if(document.body&&document.body.clientWidth){l=document.body.clientWidth}}}return l},height:function(){var l=0;if(typeof(window.innerHeight)=="number"){l=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){l=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){l=document.body.clientHeight}}}return l}};function b(o,m,l){if(m.match(/#/)){var n=window.location.href.split("#")[0];var p=m.replace(n,"");if(p=="#"){return}if(p.substr(0,1)=="#"){p=p.substr(1)}if($(p)){Protobox.reveal(o,$(p).innerHTML,l)}}else{if(m.match(o.imageTypesRegexp)){d(o,m,l)}else{j(o,m,l)}}}function d(n,m,l){var o=new Image();o.onload=function(){Protobox.reveal(n,'<div class="image"><img src="'+o.src+'" /></div>',l)};o.src=m}function j(n,m,l){new Ajax.Request(m,{method:"GET",onSuccess:function(o){Protobox.reveal(n,o.responseText,l)}})}function c(l){return l.overlay==false}function e(l){if(c(l)){return}if($("protobox-overlay")==null){$(document.body).insert('<div id="protobox-overlay"></div>')}$("protobox-overlay").hide().addClassName("protobox-overlayBG").observe("click",function(){$(document).fire("protobox:close")}).show();new Effect.Opacity("protobox-overlay",{duration:l.animationSpeed,from:0,to:l.opacity});$("protobox-overlay").observe("click",function(){Protobox.close()});return false}function a(l){if(c(l)){return}$("protobox-overlay").fade({duration:l.animationSpeed,from:l.opacity,afterFinish:function(){$("protobox-overlay").remove()}});return false}function k(n){if(n.inited){return true}else{n.inited=true}Object.extend(n,g);$(document).fire("protobox:init");var l=n.imageTypes.join("|");n.imageTypesRegexp=new RegExp(".("+l+")$","i");if($("protobox")==null){$(document.body).insert(n.protoboxHtml)}var m=[new Image(),new Image()];m[0].src=n.closeImage;m[1].src=n.loadingImage;$$("#protobox .b:first, #protobox .bl").each(function(o){m.push(new Image());m.last.src=o.getStyle("background-image").replace(/url\((.+)\)/,"$1")});$("protobox-close-image").writeAttribute("src",n.closeImage);return n}function f(l){l=k(l);if($("protobox-loading")){return true}e(l);$("protobox-body").childElements().invoke("hide");$("protobox-body").insert('<div id="protobox-loading"><img src="'+l.loadingImage+'"/></div>');$("protobox").setStyle({top:(i()[1]+(h.height()/10))+"px",left:(h.width()/2-205)+"px"}).show();$(document).observe("keypress",function(m){if(m.keyCode==Event.KEY_ESC){Protobox.close()}return true});$(document).fire("protobox:loading")}})();